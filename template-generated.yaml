AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: A simple backend (read/write to DynamoDB) with a RESTful API endpoint
  using Amazon API Gateway.
Resources:
  retriever:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: retriever
      Handler: retriever.handler
      Runtime: nodejs12.x
      CodeUri: s3://djordje-test-sam/3c0e3e452260cfa9fb0716dc24ffd52b
      Description: A simple backend (read/write to DynamoDB) with a RESTful API endpoint
        using Amazon API Gateway.
      MemorySize: 512
      Timeout: 10
      Policies:
      - DynamoDBCrudPolicy:
          TableName: transactions
      Events:
        Api1:
          Type: Api
          Properties:
            Path: /message
            Method: GET
  transactionCreator:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: transaction_creator
      Handler: transaction_creator.handler
      Runtime: nodejs12.x
      CodeUri: s3://djordje-test-sam/3c0e3e452260cfa9fb0716dc24ffd52b
      Environment:
        Variables:
          TABLE_NAME: transactions
          PRIMARY_KEY: uuid
      Policies:
      - DynamoDBCrudPolicy:
          TableName: transactions
  hbProcessor:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: hb_processor
      Handler: hb_processor.handler
      Runtime: nodejs12.x
      CodeUri: s3://djordje-test-sam/3c0e3e452260cfa9fb0716dc24ffd52b
      Description: Periodically polls an SQS queue and asynchronously consumes each
        message.
      MemorySize: 128
      Timeout: 10
      Policies:
      - SQSPollerPolicy:
          QueueName: hb_message_processing_queue
  transactions:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: transactions
      AttributeDefinitions:
      - AttributeName: uuid
        AttributeType: S
      KeySchema:
      - AttributeName: uuid
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
  QueueHb:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: hb_message_processing_queue
